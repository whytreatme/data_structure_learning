
### **`memcpy` 函数解析**
`memcpy` 是 C/C++ 中的一个**标准库函数**，用于**按字节复制内存块**。它直接操作内存，不关心数据类型，适合高效地拷贝任意数据（如数组、结构体等）。

---

## **1. 函数原型**
```c
#include <string.h>  // 头文件

void *memcpy(void *dest, const void *src, size_t n);
```

---

## **2. 参数说明**
| 参数   | 类型         | 作用                                                                 |
|--------|--------------|----------------------------------------------------------------------|
| `dest` | `void*`      | **目标内存地址**，数据将被复制到这里。                               |
| `src`  | `const void*`| **源内存地址**，数据从这里被复制（`const` 表示不会修改源数据）。      |
| `n`    | `size_t`     | **要复制的字节数**（注意是字节数，不是元素个数！）。                 |

---

## **3. 核心功能**
- **逐字节复制**：从 `src` 指向的内存地址开始，拷贝 `n` 个字节到 `dest` 指向的内存。
- **不检查重叠**：如果 `src` 和 `dest` 的内存区域重叠，行为是**未定义的**（可能出错，应用 `memmove` 代替）。
- **无类型安全**：因为它用 `void*`，需手动确保目标空间足够大。

---

## **4. 使用示例**
### **示例 1：拷贝整型数组**
```c
int src[5] = {1, 2, 3, 4, 5};
int dest[5];
memcpy(dest, src, sizeof(src));  // 拷贝整个数组（sizeof计算总字节数）
```
**结果**：`dest` 数组内容变为 `{1, 2, 3, 4, 5}`。

---

### **示例 2：拷贝结构体**
```c
struct Point { int x; int y; };
struct Point p1 = {10, 20};
struct Point p2;
memcpy(&p2, &p1, sizeof(struct Point));  // 拷贝结构体
```
**结果**：`p2.x = 10`, `p2.y = 20`。

---

### **示例 3：部分拷贝**
```c
char src[] = "Hello, World!";
char dest[10];
memcpy(dest, src, 5);  // 只拷贝前5个字节（"Hello"）
dest[5] = '\0';        // 手动添加字符串结束符
```
**结果**：`dest` 内容为 `"Hello"`。

---

## **5. 关键注意事项**
### **(1) 内存重叠问题**
- **错误场景**：`src` 和 `dest` 内存区域重叠时，`memcpy` 可能覆盖源数据。
  ```c
  int arr[5] = {1, 2, 3, 4, 5};
  memcpy(arr + 1, arr, 3 * sizeof(int));  // 未定义行为！
  ```
- **解决方案**：用 `memmove`（专门处理重叠内存的拷贝）：
  ```c
  memmove(arr + 1, arr, 3 * sizeof(int));  // 安全拷贝
  ```

### **(2) 目标空间必须足够大**
- 如果 `dest` 空间小于 `n` 字节，会导致**缓冲区溢出**（可能崩溃或数据损坏）。
  ```c
  int src[5] = {1, 2, 3, 4, 5};
  int dest[3];  // 只有3个int的空间
  memcpy(dest, src, sizeof(src));  // 错误！目标空间不足
  ```

### **(3) 不适用于动态类型（如C++对象）**
- 对包含虚函数或动态成员的 C++ 对象，`memcpy` 会破坏其内部结构（应使用拷贝构造函数或赋值运算符）。

---

## **6. 对比 `memcpy` 和 `strcpy`**
| 特性          | `memcpy`                          | `strcpy`                          |
|---------------|-----------------------------------|-----------------------------------|
| **操作单位**  | 字节                              | 字符（直到遇到 `\0`）             |
| **安全性**    | 需手动指定长度                    | 自动停止，但可能溢出目标缓冲区    |
| **用途**      | 任意二进制数据（数组、结构体等） | 仅用于以 `\0` 结尾的字符串       |

---

## **7. 典型应用场景**
1. **数组拷贝**：快速复制整块数据。
2. **网络传输**：序列化数据时拷贝内存。
3. **性能优化**：替代逐元素赋值（如循环拷贝数组）。

---

## **总结**
- **作用**：高效拷贝任意内存块。
- **参数**：`dest`（目标地址）、`src`（源地址）、`n`（字节数）。
- **注意**：避免内存重叠、确保目标空间足够。
- **替代方案**：重叠内存用 `memmove`，字符串用 `strncpy`。
